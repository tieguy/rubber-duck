{"id":"rubber-duck-0a1","title":"Journal search for Claude Code sessions","description":"Claude Code sessions need access to long-term journal history, not just recent entries.\n\nOptions:\n1. MCP server exposing journal search\n2. Let Claude Code grep state/journal.jsonl directly\n3. Python middleware: parse intent, search, inject results\n\nRelated to Claude Code refactor (rubber-duck-etf).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-03T20:37:49.097260913Z","updated_at":"2026-01-04T19:34:05.926041053Z","closed_at":"2026-01-04T19:34:05.926041053Z","close_reason":"Added journal hint to system prompt - Claude Code can grep state/journal.jsonl directly"}
{"id":"rubber-duck-0i8","title":"Google Calendar integration for nudges","description":"Nudges should draw context from GCal, not just Todoist. Options: service account auth (recommended), OAuth, or GCal MCP server. Libraries: gcsa, gcal-sync. Need to create GCP project, enable Calendar API.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-27T07:32:22.231717708Z","updated_at":"2025-12-29T16:41:45.049112776Z","closed_at":"2025-12-29T16:41:45.049112776Z","close_reason":"Closed"}
{"id":"rubber-duck-0qh","title":"Personality tuning - monitor for further adjustments","description":"Bot personality changed from 'friendly' to 'helpful executive assistant'. May need further tuning: dry humor, matter-of-fact tone, avoid exclamation marks. See memory.py:SYSTEM_PROMPT","status":"closed","priority":2,"issue_type":"chore","created_at":"2025-12-27T07:32:14.458604958Z","updated_at":"2025-12-27T07:32:52.148232159Z","closed_at":"2025-12-27T07:32:52.148232159Z","close_reason":"Addressed - personality updated to executive assistant style"}
{"id":"rubber-duck-2dc","title":"Add API budget tracking with daily spending cap","description":"Inspired by Bud (https://github.com/vthunder/bud). Track API costs and enforce a daily spending cap with graceful degradation.\n\nEspecially important if autonomous perch ticks are added - prevents runaway costs.\n\nFeatures:\n- Track cost per API call (Anthropic pricing: Opus vs Sonnet)\n- Daily budget cap (e.g., $5/day default)\n- Graceful degradation when approaching limit (switch to Sonnet, reduce autonomy)\n- Reset at midnight\n- Expose via tool so agent is cost-aware\n\nImplementation: Add budget.py with cost tracking, integrate with agent loop.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-01T03:14:01.359604167Z","updated_at":"2026-01-04T19:17:11.905883764Z","closed_at":"2026-01-04T19:17:11.905883764Z","close_reason":"No longer needed - switched to Max subscription, no API costs to track"}
{"id":"rubber-duck-2sm","title":"Consider moving weekly review agent guidance to a skill when skills are implemented","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-02T01:08:23.985139054Z","updated_at":"2026-01-05T04:32:41.471753127Z","closed_at":"2026-01-05T04:32:41.471753127Z","close_reason":"Duplicate of rubber-duck-jay (Convert GTD workflows to Claude Code skills)"}
{"id":"rubber-duck-31k","title":"Optimize file, memory, and LLM accesses in agent loop","description":"## Problem\n\nAgent may be making redundant tool calls for data that's already in context.\n\n## Context Already Available (No Tool Needed)\n\n- **Memory blocks**: Already embedded in system prompt via `_build_system_prompt()`\n- **Recent journal**: Last 3 exchanges injected via `_get_recent_context()`\n\n## Requires Tool Call\n\n- File contents (state/inbox.md, etc.) ‚Üí `read_file`\n- Older journal entries ‚Üí `read_journal`\n- Archival memory search ‚Üí `search_memory`\n\n## Potential Issues\n\n1. Agent calling `get_memory_blocks` explicitly - redundant since blocks are in system prompt\n2. Agent reading files before checking memory - order may not be optimal\n3. System prompt doesn't clearly communicate what's already loaded vs. needs fetching\n\n## Possible Fixes\n\n1. Update system prompt to explicitly say 'Memory blocks are already loaded above - no need to call get_memory_blocks'\n2. Consider removing `get_memory_blocks` tool entirely (or rename to `list_memory_blocks` for discovery)\n3. Add efficiency hints to system prompt about what's pre-loaded\n\n## Notes\n\n- Observed during memory block creation task where tool sequence seemed suboptimal\n- Exact sequence not captured (overwritten when editing pass ended)","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-01T22:35:35.298657289Z","updated_at":"2026-01-04T19:17:14.096440446Z"}
{"id":"rubber-duck-462","title":"Prime Rubber Duck memory with owner context","description":"After Strix-style architecture is working, prime memory blocks with:\n\n- Owner facts: Luis, job/work context, location, timezone\n- Family: Asa (son), Krissa (partner), relevant dynamics\n- Daily routine: work patterns, exercise timing, family time\n- GTD principles: methodology summary, how it applies to owner\n- ADHD context: relevant patterns, accommodation strategies\n\nThis bootstraps the bot with enough context to be immediately useful rather than starting cold.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-30T18:16:29.231409872Z","updated_at":"2025-12-31T20:27:13.259746213Z","closed_at":"2025-12-31T20:27:13.259746213Z","close_reason":"Closed"}
{"id":"rubber-duck-6qh","title":"Add preemption handling for autonomous work","description":"Inspired by Bud (https://github.com/vthunder/bud). If/when autonomous perch ticks are added, need graceful preemption when user messages arrive.\n\nThe agent should:\n- Acknowledge incoming user message\n- Wrap up current autonomous work\n- Respond to user before resuming autonomous work\n\nDepends on: autonomous perch ticks feature","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-01T03:07:45.737800821Z","updated_at":"2026-01-03T01:14:08.988159067Z","closed_at":"2026-01-03T01:14:08.988159067Z","close_reason":"Implemented preemption module with state machine, message handler updates, and perch tick integration"}
{"id":"rubber-duck-792","title":"Add crisis protocol to guidelines","description":"From docs/plans/2026-01-01-wellness-lessons.md Phase 1. Add crisis protocol to guidelines memory block - redirect to human support, don't counsel. Also consider support_resources block. BLOCKED: Need to discuss approach with friends first.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-01T18:36:41.260035218Z","updated_at":"2026-01-01T18:36:41.260035218Z"}
{"id":"rubber-duck-7rb","title":"Add autonomous perch ticks for proactive work","description":"Inspired by Bud (https://github.com/vthunder/bud). Add a perch system that periodically wakes up and asks 'is there work to do?' without waiting for user input.\n\nPrioritize: scheduled items ‚Üí active goals ‚Üí maintenance\n\nUse cases:\n- Proactively follow up on waiting-for items (\u003e14 days)\n- Notice overdue tasks and reach out\n- Do maintenance like archiving insights to memory\n- Check for inbox items needing processing\n\nMinimal implementation: scheduler calls perch_tick() every 30 min, which decides if proactive DM needed.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-01T03:07:44.779430613Z","updated_at":"2026-01-02T00:11:19.871518765Z","closed_at":"2026-01-02T00:11:19.871518765Z","close_reason":"Implemented perch ticks with hourly archiving"}
{"id":"rubber-duck-9rz","title":"Add explicit working/idle state machine","description":"Inspired by Bud (https://github.com/vthunder/bud). Track working/idle state explicitly rather than implicitly in journal.\n\nBenefits:\n- 'I am currently working on X' awareness\n- Avoid duplicate/conflicting work\n- Better context for nudges ('you were working on X earlier')\n- State persistence across restarts\n\nImplementation: Add state.json or state table with current_task, started_at, context fields.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-01T03:07:47.696697331Z","updated_at":"2026-01-03T01:14:03.25664249Z","closed_at":"2026-01-03T01:14:03.25664249Z","close_reason":"Implemented by rubber-duck-6qh preemption handling - includes BotStatus state machine (idle/working/wrapping_up)"}
{"id":"rubber-duck-a5r","title":"Build test framework for pre-deploy validation and self-modification safety","description":"## Problem\n\nWe've deployed broken code multiple times due to:\n- API changes (Todoist get_tasks ‚Üí filter_tasks)\n- API changes (Letta .get() ‚Üí .retrieve())  \n- Invalid model IDs\n- Stale imports from archived modules\n\nWhen the bot gains self-modification capabilities, it needs to validate its own changes before committing.\n\n## Requirements\n\n### Pre-deploy validation\n- Syntax check all Python files\n- Import validation (catch missing/moved modules)\n- Basic integration tests that can run without API keys (mocked)\n- Integration tests that run with API keys (CI secrets or local)\n\n### Self-modification safety\n- Bot should be able to run tests before committing changes\n- Test tool available to agent: `run_tests()` \n- Fail-safe: don't commit if tests fail\n\n### Test categories\n1. **Unit tests**: Pure logic, no external deps\n2. **Integration tests (mocked)**: Test API wrappers with mocked responses\n3. **Integration tests (live)**: Actual API calls (for CI with secrets)\n4. **Smoke tests**: Quick validation that imports work and basic flow runs\n\n### Implementation ideas\n- pytest as test runner\n- pytest-mock for mocking\n- Add `run_tests` tool to agent tools.py\n- Pre-commit hook or CI workflow\n- `scripts/validate.py` for quick local checks\n\n## Success criteria\n- `uv run pytest` passes before every deploy\n- Bot can run `run_tests()` tool and get pass/fail result\n- CI blocks merges with failing tests","status":"open","priority":1,"issue_type":"feature","created_at":"2025-12-31T02:18:55.129870207Z","updated_at":"2025-12-31T02:18:55.129870207Z"}
{"id":"rubber-duck-aji","title":"Define GTD in system prompt","description":"The system prompt references GTD (Getting Things Done) but never defines it. The LLM has some knowledge but we should provide a formal definition/summary with pointers to resources for more consistent behavior.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T16:11:30.44550787Z","updated_at":"2025-12-29T16:41:45.076116025Z","closed_at":"2025-12-29T16:41:45.076116025Z","close_reason":"Closed"}
{"id":"rubber-duck-bs1","title":"Perch pings polluting journal with noise","description":"Autonomous perch ticks are filling journal.jsonl, pushing substantive conversations out of the recent context window.\n\n**Decision:** Log less for now. Perch only writes to journal if it took action or found something notable.\n\n**Future:** Add 'source' field (perch|conversation) and filter when loading recent context - needed once perch becomes more autonomous/active.\n\n**Implementation:**\n- Check perch tick handler - skip journal logging if no action taken\n- Add 'source' field to journal entries now (forward-compatible)\n\nImpact: Recent context injection becomes less useful when dominated by routine check-ins.","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-03T20:37:50.117421195Z","updated_at":"2026-01-05T19:02:10.916616414Z","closed_at":"2026-01-05T19:02:10.916616414Z","close_reason":"Closed"}
{"id":"rubber-duck-d5v","title":"Marvin to Todoist migration","description":"Migrated tasks from Amazing Marvin to Todoist. Script: scripts/migrate_marvin_to_todoist.py. Created 25 projects, 36 tasks, 4 labels (someday-maybe, asa, krissa, family).","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T07:32:35.002842703Z","updated_at":"2025-12-27T07:32:54.039834099Z","closed_at":"2025-12-27T07:32:54.039834099Z","close_reason":"Complete - 25 projects, 36 tasks, 4 labels migrated"}
{"id":"rubber-duck-dey","title":"Add markdown-based skills system","description":"Inspired by Bud (https://github.com/vthunder/bud). Replace hardcoded GTD workflows with extensible markdown skill files.\n\nCurrent hardcoded workflows:\n- src/rubber_duck/integrations/tools/morning_planning.py\n- src/rubber_duck/integrations/tools/weekly_review.py\n\nBenefits:\n- Add new procedures without code changes\n- User-customizable workflows\n- Skills can reference other skills\n- Version control friendly\n\nImplementation: Load .md files from state/skills/ or skills/ directory, inject into system prompt or make available as tool.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-01T03:07:46.680502107Z","updated_at":"2026-01-04T19:22:31.642262498Z","closed_at":"2026-01-04T19:22:31.642262498Z","close_reason":"Architecture addressed by Claude Code refactor - skills now go in .claude/skills/"}
{"id":"rubber-duck-eps","title":"Refactor to Strix-style architecture: Letta for memory, Anthropic/Opus for LLM","description":"Major architectural refactor following Strix's three-tier memory pattern.\n\n## Target Architecture\n\n**Letta becomes memory-only:**\n- Core blocks: persona, values, communication_style, guidelines, patterns\n- Index blocks: pointers to files (recent_insights, current_focus, schedule)\n- No LLM calls through Letta\n\n**Anthropic/Opus for all reasoning:**\n- Use Claude Code SDK or direct API\n- Owner's API key, explicitly Opus model\n- Bot controls its own context assembly\n\n**Git as provenance:**\n- Bot can modify its own files (nudge.yaml, state/, etc.)\n- All changes committed with accountability\n- Enables rollback, diff-as-introspection\n\n**Self-modification MVP:**\n- Bot can edit nudge.yaml to adjust its own schedule\n- Bot can edit its own system prompt/guidelines\n- State files: inbox.md, today.md, patterns.md, insights/\n\n## Why This Matters\n\nFrom Strix article:\n- 'Structure is identity' - scaffolding determines behavior\n- Concrete tasks \u003e open permissions (prevents collapse)\n- Three tiers solve context window vs cumulative identity tension\n- Git provides trust signals ('proof, not claims')\n\n## Key Changes\n\n1. Extract memory blocks from Letta agent creation\n2. Add Claude Code SDK / anthropic client\n3. Context assembly: load core + indices, selectively load files\n4. Tool execution moves from Letta sandbox to local\n5. Add file modification capabilities (nudge.yaml, state/)\n6. Git commit after state changes\n\n## Reference\n\nArchitecture from: https://timkellogg.me/blog/2025/12/30/strix-memory","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-30T17:49:09.692816936Z","updated_at":"2025-12-31T20:16:57.677099043Z","closed_at":"2025-12-31T20:16:57.677099043Z","close_reason":"Closed"}
{"id":"rubber-duck-etf","title":"Refactor Discord bot to use Claude Code via tmux","description":"**Motivation:**\n- Use Claude Code's native tools instead of maintaining custom implementations\n- Persistent sessions across Discord messages\n- Use Code subscription instead of API tokens\n\n**Design decisions so far:**\n- Hybrid approach: Claude Code handles file/git/bash/web; Python keeps Todoist/Calendar/Memory tools\n- Communication method: TBD (was exploring options when paused)\n\n**Options for communication:**\n1. stdin/stdout streaming\n2. --print mode (one-shot)\n3. SDK/API mode (claude sdk chat)\n\nPaused to investigate API budget first - may not need this refactor if costs are low.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-03T19:53:01.836178537Z","updated_at":"2026-01-03T21:44:01.835968873Z","closed_at":"2026-01-03T21:44:01.835973219Z"}
{"id":"rubber-duck-gaz","title":"Configure, test and deploy Google Calendar integration","description":"Set up service account credentials, test the gcal integration locally, and deploy to Fly.io with the required GOOGLE_SERVICE_ACCOUNT_JSON secret. See docs/gcal-setup.md for setup instructions.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-29T20:28:37.593873764Z","updated_at":"2025-12-29T20:28:37.593873764Z"}
{"id":"rubber-duck-ilr","title":"Run SonarQube scan for code quality and security analysis","description":"Set up and run SonarQube analysis to identify code quality issues, security vulnerabilities, and technical debt. Consider using SonarCloud for CI integration.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-29T18:30:01.781997847Z","updated_at":"2026-01-05T03:29:33.596603389Z"}
{"id":"rubber-duck-jay","title":"Convert GTD workflows to Claude Code skills","description":"Convert existing Python GTD workflows to Claude Code skills:\n\n- src/rubber_duck/integrations/tools/morning_planning.py ‚Üí .claude/skills/gtd/morning-planning.md\n- src/rubber_duck/integrations/tools/weekly_review.py ‚Üí .claude/skills/gtd/weekly-review.md\n\nSkills should guide Claude Code through the GTD procedure using Todoist/memory skills rather than hardcoding the logic in Python.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-04T19:22:32.55053715Z","updated_at":"2026-01-06T01:35:29.265117132Z","closed_at":"2026-01-06T01:35:29.265117132Z","close_reason":"Implemented GTD skills system: CLI tools (scan-deadlines, check-projects, check-waiting, check-someday, calendar-today/range) + Claude Code skills (planning-daily, reviewing-weekly). Deployed v57."}
{"id":"rubber-duck-jdh","title":"GTD skills integration from marvin-to-model","description":"Port GTD skills system from marvin-to-model. Skills: priority-rules, follow-up-strategy, time-awareness, scheduling-strategy. Sub-reviews: morning-planning, end-of-day, project-review, waiting-for-review, deadline-scan, someday-maybe-review. Options: slash commands, smart detection, or nudge-triggered reviews.","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-27T07:32:43.737426827Z","updated_at":"2025-12-27T07:42:44.669560049Z","closed_at":"2025-12-27T07:42:44.669560049Z","close_reason":"All GTD skills implemented: morning planning, EOD review, weekly review, priority rules"}
{"id":"rubber-duck-jdh.1","title":"Morning planning workflow","description":"Port morning-planning sub-review from marvin-to-model. Creates realistic schedule for TODAY only. Uses: time-awareness, priority-rules, scheduling-strategy, morning-output-format skills. Should check calendar first, identify slipped tasks, apply 3-step priority algorithm, create time-blocked schedule.","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-27T07:34:48.293868041Z","updated_at":"2025-12-27T07:42:34.831043768Z","closed_at":"2025-12-27T07:42:34.831043768Z","close_reason":"Implemented run_morning_planning Letta tool","dependencies":[{"issue_id":"rubber-duck-jdh.1","depends_on_id":"rubber-duck-jdh","type":"parent-child","created_at":"2025-12-27T07:34:48.318619986Z","created_by":"daemon"}]}
{"id":"rubber-duck-jdh.2","title":"End-of-day review workflow","description":"Port end-of-day sub-review from marvin-to-model. Reviews today's completions, suggests Todoist updates with rationale, prioritizes tomorrow (no time blocks - morning planning does that). Uses: priority-rules, end-of-day-output-format skills.","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-27T07:34:57.880080047Z","updated_at":"2025-12-27T07:42:35.662075212Z","closed_at":"2025-12-27T07:42:35.662075212Z","close_reason":"Implemented run_end_of_day_review Letta tool","dependencies":[{"issue_id":"rubber-duck-jdh.2","depends_on_id":"rubber-duck-jdh","type":"parent-child","created_at":"2025-12-27T07:34:57.897603118Z","created_by":"daemon"}]}
{"id":"rubber-duck-jdh.3","title":"Weekly review workflow","description":"Port weekly review sub-reviews from marvin-to-model. Includes: project-review (check all projects have next actions, health status), waiting-for-review (follow-up decisions), deadline-scan (overdue + upcoming), someday-maybe-review (activate/keep/delete), category-health (workload distribution). Uses health symbols: ‚úì HEALTHY | ‚ö†Ô∏è NEEDS ATTENTION | üî¥ STALLED","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-27T07:35:06.382376584Z","updated_at":"2025-12-27T07:42:36.476252877Z","closed_at":"2025-12-27T07:42:36.476252877Z","close_reason":"Implemented run_weekly_review Letta tool","dependencies":[{"issue_id":"rubber-duck-jdh.3","depends_on_id":"rubber-duck-jdh","type":"parent-child","created_at":"2025-12-27T07:35:06.395658222Z","created_by":"daemon"}]}
{"id":"rubber-duck-jdh.4","title":"Priority rules and scheduling strategies","description":"Enhance system prompt or create dedicated tools for GTD decision-making. Priority-rules: 3-step algorithm (urgency‚Üífeasibility‚Üístrategic value). Scheduling-strategy: match task complexity to time blocks (complex=2hr+, moderate=1-2hr, simple=any). Follow-up-strategy: timing matrix for waiting-for items. Time-awareness: always check current time before scheduling.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-27T07:35:13.448848598Z","updated_at":"2025-12-27T07:42:38.076860561Z","closed_at":"2025-12-27T07:42:38.076860561Z","close_reason":"Priority rules embedded in system prompt and workflow tools","dependencies":[{"issue_id":"rubber-duck-jdh.4","depends_on_id":"rubber-duck-jdh","type":"parent-child","created_at":"2025-12-27T07:35:13.472511303Z","created_by":"daemon"}]}
{"id":"rubber-duck-js8","title":"Connect to personal CRM (Relatable)","description":"Integrate with Relatable personal CRM via their REST API.\n\n## API Overview\nRelatable provides a RESTful API for managing personal contacts/relationships.\n\n## Capabilities\n- **Data Retrieval**: GET all people or individual records\n- **Record Creation**: POST to add new contacts\n- **Data Modification**: PUT to update existing records\n\n## Endpoints (API v1)\n- GET /people - Retrieve all people\n- POST /people - Create new record\n- GET /people/{id} - Find individual record\n- PUT /people/{id} - Modify existing record\n\n## Authentication\nRequires API key authentication. Key must be generated from Relatable dashboard.\n\n## Reference\nhttps://relatable.readme.io/reference/getting-started-with-relatable-api\n\n## Implementation Notes\n- Add Relatable client to integrations/\n- Create tools: query_contacts, create_contact, update_contact\n- Consider syncing with memory blocks for relationship context","status":"open","priority":2,"issue_type":"feature","created_at":"2026-01-05T19:36:45.567286756Z","updated_at":"2026-01-05T19:36:45.567286756Z"}
{"id":"rubber-duck-k8i","title":"Add Todoist task URLs to all tool outputs","description":"Todoist tasks have web URLs (https://todoist.com/app/task/{task_id}). All tools that output task references should include clickable links. Cross-cutting concern - applies to weekly review sub-reviews, morning planning, query_todoist, etc.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T01:17:38.077273966Z","updated_at":"2026-01-05T19:49:17.637825451Z","closed_at":"2026-01-05T19:49:17.637825451Z","close_reason":"Closed"}
{"id":"rubber-duck-kam","title":"Summarize marvin-to-model GTD learnings from prompts","description":"Use Claude to analyze marvin-to-model's prompts and extract:\n- GTD principles it has learned/refined\n- Task management patterns that work\n- Workflow insights worth porting to Rubber Duck\n\nGoal: Capture institutional knowledge from the marvin experiment to inform Rubber Duck's guidelines and patterns memory blocks.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-31T20:56:42.664658153Z","updated_at":"2026-01-02T00:35:50.534718615Z","closed_at":"2026-01-02T00:35:50.534718615Z","close_reason":"Learnings captured in rubber-duck-qx1 (two-phase weekly review port)"}
{"id":"rubber-duck-m4g","title":"Nudge timezone issue - exercise fired at 8am instead of 3pm","description":"Exercise nudge scheduled for 15:00 America/Los_Angeles fired at 8am. Scheduler has timezone param set but may not be working correctly. Check: (1) APScheduler timezone handling, (2) TZ env var in container, (3) whether this was a first-run/startup quirk.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-27T15:33:31.656687878Z","updated_at":"2025-12-27T23:21:18.627561183Z","closed_at":"2025-12-27T23:21:18.627561183Z","close_reason":"Fixed by adding TZ=America/Los_Angeles to fly.toml"}
{"id":"rubber-duck-o62","title":"Optimize agent loop to avoid unnecessary LLM calls after tool execution","description":"## Problem\n\nThe agent loop currently makes an extra LLM API call after tool execution even when Claude already provided response text with the tool calls.\n\n### Current behavior (loop.py lines 315-345):\n\n```python\nwhile tool_calls \u003c max_tools:\n    response = await client.messages.create(...)  # API CALL #1\n    \n    tool_use_blocks = [b for b in response.content if b.type == \"tool_use\"]\n    text_blocks = [b for b in response.content if b.type == \"text\"]\n    \n    if not tool_use_blocks:\n        return _extract_final_text(text_blocks)  # Only returns if NO tools\n    \n    # Execute tools\n    tool_results = [_execute_tool_block(block) for block in tool_use_blocks]\n    messages.append({\"role\": \"user\", \"content\": tool_results})\n    \n    # Only exits here if stop_reason == \"end_turn\"\n    if response.stop_reason == \"end_turn\":\n        return _extract_final_text(text_blocks)\n    \n    # Otherwise loops back for ANOTHER API call\n```\n\n### The issue\n\nClaude often returns:\n- tool_use blocks (actions to take)\n- text blocks (response to show user)  \n- stop_reason=\"tool_use\" (not \"end_turn\")\n\nWe have perfectly good response text, but we discard it and make another API call because stop_reason != \"end_turn\".\n\n### Example: \"complete task 123\"\n\n1. API call #1: Claude returns `complete_todoist_task` + \"Done! I've completed that task.\" + stop_reason=\"tool_use\"\n2. We execute the tool (succeeds)\n3. We DISCARD the text Claude gave us\n4. API call #2: Claude returns \"I've completed task 123 for you.\"\n\nWe paid for 2 API calls when 1 would suffice.\n\n## Solution: Success-gated early return\n\nNot \"fire-and-forget\" - we must check tool success. But if tools succeed AND Claude provided text, return immediately without another LLM call.\n\n```python\n# Execute tools\ntool_results = [_execute_tool_block(block) for block in tool_use_blocks]\n\n# Check if all succeeded\ndef tool_succeeded(result: str) -\u003e bool:\n    error_signals = [\"error\", \"failed\", \"exception\", \"not found\", \"denied\"]\n    return not any(s in result.lower() for s in error_signals)\n\nall_succeeded = all(tool_succeeded(r[\"content\"]) for r in tool_results)\n\n# If Claude gave us text AND tools succeeded, return immediately\nif text_blocks and all_succeeded:\n    return _extract_final_text(text_blocks)\n\n# Otherwise loop back - Claude needs to handle the failure or provide response\nmessages.append({\"role\": \"user\", \"content\": tool_results})\n```\n\n## Decision matrix\n\n| Scenario | Action | API calls |\n|----------|--------|-----------|\n| Tools succeeded + Claude gave text | Return text immediately | 1 |\n| Tools succeeded + no text | Loop back for response | 2 |\n| Any tool failed | Loop back so Claude can explain | 2 |\n\n## Implementation notes\n\n1. **Success detection heuristic**: Check for error-like strings in tool results. Could be refined per-tool if needed.\n\n2. **Still log to journal**: Even when short-circuiting, log tool results to journal for debugging/history.\n\n3. **Some tools need result interpretation**: Tools like `query_todoist` or `search_memory` return data Claude needs to see. But if Claude already wrote a response, it chose not to wait - honor that choice if tools succeeded.\n\n4. **Prompt tuning**: May want to encourage Claude to include response text with tool calls when the response is predictable (\"Done!\", \"Added task\", etc.)","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-01T03:39:48.583825976Z","updated_at":"2026-01-01T03:49:47.375575348Z","closed_at":"2026-01-01T03:49:47.375575348Z","close_reason":"Closed"}
{"id":"rubber-duck-oq5","title":"Investigate why Rubber Duck feels less useful than marvin-to-model","description":"Despite similar Todoist data, Rubber Duck responses feel less helpful than the previous marvin-to-model setup.\n\nPotential causes to investigate:\n\n1. **Model selection**: No model is explicitly configured in agent creation (memory.py:164). Letta may be defaulting to a smaller/cheaper model. Check Letta dashboard or API for actual model being used.\n\n2. **System prompt differences**: Compare rubber-duck system prompt (~100 lines, GTD-focused) vs marvin-to-model prompt. Key differences may include:\n   - Level of context about user preferences/patterns\n   - Specificity of instructions\n   - Examples of good responses\n\n3. **Memory utilization**: Letta has memory blocks but they're minimally initialized ('I am learning about them'). May not be accumulating useful context.\n\n4. **Tool result interpretation**: Agent may be getting raw Todoist data but not synthesizing it well.\n\nAction items:\n- Check Letta dashboard for model config\n- Compare system prompts side-by-side\n- Review conversation logs for quality patterns\n- Consider adding llm_config to agent creation with explicit model choice","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-30T03:59:09.778436187Z","updated_at":"2025-12-31T20:56:41.486242458Z","closed_at":"2025-12-31T20:56:41.486242458Z","close_reason":"Closed"}
{"id":"rubber-duck-ozu","title":"Consider minimal base image (Chainguard/Red Hat UBI) instead of Ubuntu","description":"Evaluate switching from full Ubuntu base image to a minimal image like Chainguard or Red Hat UBI for smaller size and reduced attack surface.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T16:11:29.476084412Z","updated_at":"2025-12-29T20:31:07.675632589Z","closed_at":"2025-12-29T20:31:07.675632589Z","close_reason":"wontfix: Distroless images lack shell access, making Fly.io debugging via ssh console impossible. Current python:3.11-slim is a reasonable balance."}
{"id":"rubber-duck-pta","title":"Document update_todoist_project in system prompt","description":"The update_todoist_project tool exists in letta_tools.py but is missing from the system prompt's Project Operations list. Add it for consistency.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T16:17:13.733791365Z","updated_at":"2025-12-29T16:41:45.108123013Z","closed_at":"2025-12-29T16:41:45.108123013Z","close_reason":"Closed"}
{"id":"rubber-duck-q6q","title":"Someday-maybe project hierarchy support","description":"Implement someday-maybe project convention: a top-level 'someday-maybe' project with sub-sections (family, self, etc). Any project at any depth under someday-maybe should be excluded from weekly review health assessments. Requires robust ancestry checking.","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-27T23:24:27.148023398Z","updated_at":"2025-12-27T23:27:25.998146051Z","closed_at":"2025-12-27T23:27:25.998146051Z","close_reason":"Implemented someday-maybe project hierarchy detection"}
{"id":"rubber-duck-qx1","title":"Port two-phase weekly review from marvin-to-model","description":"## Goal\n\nReplace single-pass run_weekly_review() with interactive, multi-step weekly review session.\n\n## Design\n\nSee docs/plans/2026-01-02-weekly-review-redesign.md\n\n## Summary\n\n- 6 sub-review tools (calendar, deadline, waiting-for, project, category, someday-maybe)\n- 1 conductor tool managing session state and sequencing\n- Natural conversation between each step\n- Ports follow-up strategy and priority rules from marvin-to-model\n\n## Dependencies\n\n- rubber-duck-gaz (GCal integration) blocks calendar_review\n- rubber-duck-k8i (Todoist URLs) - nice to have\n- rubber-duck-2sm (skill migration) - future consideration","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T00:35:42.652523061Z","updated_at":"2026-01-02T02:20:16.956025009Z","closed_at":"2026-01-02T02:20:16.956025009Z","close_reason":"Closed"}
{"id":"rubber-duck-sls","title":"Deploy Rubber Duck to Fly.io","description":"Set up production deployment on Fly.io. Needs: (1) fly.toml config, (2) secrets for DISCORD_TOKEN, LETTA_API_KEY, TODOIST_API_KEY, (3) TZ=America/Los_Angeles env var, (4) health checks, (5) logging setup.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-27T15:33:32.506075486Z","updated_at":"2025-12-27T16:20:26.420326273Z","closed_at":"2025-12-27T16:20:26.420326273Z","close_reason":"Deployed to Fly.io in LAX region. Bot is running and connected to Discord."}
{"id":"rubber-duck-vq5","title":"Future.co integration","description":"Fitness coaching app - probably no public API. Parked. Exercise nudge just reminds user to open the app.","status":"closed","priority":4,"issue_type":"task","created_at":"2025-12-27T07:32:27.825026851Z","updated_at":"2025-12-27T07:32:53.165552992Z","closed_at":"2025-12-27T07:32:53.165552992Z","close_reason":"Parked - no public API available"}
{"id":"rubber-duck-wy1","title":"Clarify Todoist context in system prompt","description":"The prompt mentions 'their Todoist tasks' but doesn't explain what Todoist is or that the agent accesses it via tools. Should clarify: 'you have access to their tasks via tools that connect to Todoist, their task management system.'","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T16:12:59.084127178Z","updated_at":"2025-12-29T16:41:45.095250738Z","closed_at":"2025-12-29T16:41:45.095250738Z","close_reason":"Closed"}
{"id":"rubber-duck-xbc","title":"Remove or justify 'USE THESE\\!' emphasis on workflow tools","description":"The system prompt has 'GTD Workflow Tools (USE THESE\\!)' but no similar emphasis on other tool categories. Either remove the emphasis for consistency, or add rationale for why workflows need special nudging.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T16:17:15.009395057Z","updated_at":"2025-12-29T16:41:45.122450975Z","closed_at":"2025-12-29T16:41:45.122450975Z","close_reason":"Closed"}
{"id":"rubber-duck-z3z","title":"Debug and fix restart_self mechanism","description":"The bot's self-restart mechanism (restart_self tool in agent/tools.py) has failed multiple times.\n\nCurrent implementation uses os.execv() to replace the process, but this approach appears unreliable in the Fly.io deployment environment.\n\nNeed to investigate:\n- What error/behavior occurs on restart attempt?\n- Is os.execv() appropriate for containerized environments?\n- Alternative approaches:\n  - Signal the supervisor/init process to restart\n  - Exit with specific code and let Fly.io restart policy handle it\n  - Use a wrapper script that restarts on exit\n  - Fly.io machine restart API\n\nRelated: The bot pushes code changes and then tries to restart to pick them up.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-01T03:17:25.86429216Z","updated_at":"2026-01-01T18:25:06.672779821Z","closed_at":"2026-01-01T18:25:06.672779821Z","close_reason":"Closed"}
{"id":"rubber-duck-zjy","title":"Fix Letta tool registration errors - missing type annotations","description":"Letta requires type annotations on ALL functions in tool source files, including nested helpers. Errors:\n- morning_planning.py: format_project() missing docstring\n- end_of_day_review.py: format_calendar_event(event) missing type annotation\n- weekly_review.py: get_next_action(tasks) missing type annotation\n\nThese prevent tool updates from registering. Add type hints to all helper functions.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-30T03:55:17.640559566Z","updated_at":"2025-12-31T22:51:04.64383697Z","closed_at":"2025-12-31T22:51:04.64383697Z","close_reason":"Closed"}
